# תרגילים - SQLModel ו-MySQL Connector

## הוראות כלליות
- כל תרגיל מתחיל מהבסיס ומתקדם בהדרגה
- נסה לפתור את התרגילים לפי הסדר
- השתמש בתיעוד הרשמי אם נתקעת
- בדוק את הקוד שלך עם נתוני דוגמה

---

## חלק 1: MySQL Connector - יסודות

### תרגיל 1.1: חיבור ראשון
צור תוכנית Python שמתחברת לשרת MySQL ומדפיסה הודעת הצלחה.

**דרישות:**
- השתמש ב-mysql.connector
- התחבר עם user='root'
- טפל בשגיאות אפשריות
- סגור את החיבור בצורה נכונה

---

### תרגיל 1.2: יצירת בסיס נתונים
כתוב פונקציה שיוצרת בסיס נתונים חדש בשם `library_db`.

**דרישות:**
- הפונקציה תקבל פרמטר לשם בסיס הנתונים
- בדוק אם בסיס הנתונים כבר קיים לפני יצירה
- הדפס הודעה מתאימה על הצלחה או כישלון

---

### תרגיל 1.3: יצירת טבלת ספרים
צור טבלה בשם `books` עם השדות הבאים:
- `id` - מספר שלם, מפתח ראשי, אוטומטי
- `title` - טקסט עד 200 תווים, חובה
- `author` - טקסט עד 100 תווים, חובה
- `year` - מספר שלם
- `price` - מספר עשרוני (2 ספרות אחרי הנקודה)
- `in_stock` - בוליאני (ברירת מחדל TRUE)

---

### תרגיל 1.4: הוספת ספרים
כתוב פונקציה `add_book(title, author, year, price)` שמוסיפה ספר חדש לטבלה.

**דרישות:**
- השתמש ב-parameterized queries
- החזר את ה-ID של הספר שנוסף
- טפל בשגיאות

---

### תרגיל 1.5: קריאת ספרים
כתוב שתי פונקציות:

**א. `get_all_books()`** - מחזירה את כל הספרים
**ב. `get_book_by_id(book_id)`** - מחזירה ספר ספציפי

**דרישות:**
- הצג את התוצאות בצורה קריאה
- טפל במקרה שהספר לא נמצא

---

### תרגיל 1.6: חיפוש ספרים
כתוב פונקציה `search_books_by_author(author_name)` שמחזירה את כל הספרים של מחבר מסוים.

**בונוס:** הוסף אפשרות לחיפוש חלקי (LIKE)

---

### תרגיל 1.7: עדכון מחיר
כתוב פונקציה `update_book_price(book_id, new_price)` שמעדכנת את מחיר הספר.

**דרישות:**
- בדוק שהספר קיים לפני עדכון
- הדפס כמה שורות עודכנו

---

### תרגיל 1.8: מחיקת ספר
כתוב פונקציה `delete_book(book_id)` שמוחקת ספר מהמערכת.

**דרישות:**
- אשר עם המשתמש לפני מחיקה
- הדפס הודעה על הצלחה/כישלון

---

### תרגיל 1.9: ספירה וסטטיסטיקות
כתוב פונקציות הבאות:

**א. `count_books()`** - כמה ספרים יש במערכת
**ב. `get_average_price()`** - מחיר ממוצע של ספר
**ג. `get_most_expensive_book()`** - הספר היקר ביותר

---

### תרגיל 1.10: הוספה המונית
כתוב פונקציה שמקבלת רשימה של ספרים ומכניסה אותם בבת אחת.

**דוגמה:**
```python
books = [
    ("ספר 1", "מחבר 1", 2020, 50.00),
    ("ספר 2", "מחבר 2", 2021, 75.50),
    ("ספר 3", "מחבר 1", 2022, 60.00)
]
```

**דרישות:**
- השתמש ב-`executemany()`
- טפל בשגיאות

---

## חלק 2: SQLModel - יסודות

### תרגיל 2.1: מודל ראשון
צור מחלקת `Book` עם SQLModel שמייצגת ספר.

**שדות:**
- id (מפתח ראשי, אוטומטי)
- title (חובה)
- author (חובה)
- year
- price
- in_stock (ברירת מחדל True)

---

### תרגיל 2.2: חיבור ויצירת טבלה
צור חיבור ל-MySQL עם SQLModel וצור את הטבלה.

**דרישות:**
- השתמש ב-`create_engine`
- התחבר ל-`library_db`
- צור את הטבלה עם `create_all`

---

### תרגיל 2.3: הוספת ספרים עם SQLModel
כתוב פונקציה `add_book_orm(title, author, year, price)` שמוסיפה ספר באמצעות SQLModel.

**דרישות:**
- השתמש ב-Session
- החזר את האובייקט שנוצר
- הדפס את ה-ID שנוצר

---

### תרגיל 2.4: קריאת כל הספרים
כתוב פונקציה `get_all_books_orm()` שמחזירה את כל הספרים.

**דרישות:**
- השתמש ב-`select()`
- הדפס כל ספר בצורה מסודרת

---

### תרגיל 2.5: סינון ספרים
כתוב פונקציות סינון:

**א.** `get_books_by_year(year)` - ספרים משנה מסוימת
**ב.** `get_expensive_books(min_price)` - ספרים מעל מחיר מסוים
**ג.** `get_books_in_stock()` - רק ספרים זמינים

---

### תרגיל 2.6: עדכון עם SQLModel
כתוב פונקציה `update_book_orm(book_id, **kwargs)` שמעדכנת שדות של ספר.

**דוגמה לשימוש:**
```python
update_book_orm(1, price=99.99, in_stock=False)
```

---

### תרגיל 2.7: מחיקה עם SQLModel
כתוב פונקציה `delete_book_orm(book_id)` שמוחקת ספר.

**דרישות:**
- בדוק שהספר קיים
- הדפס הודעה מתאימה

---

### תרגיל 2.8: אימות נתונים
שפר את מודל ה-Book עם אימותים:

**דרישות:**
- title - לפחות 3 תווים
- author - לפחות 2 תווים
- year - בין 1900 ל-2030
- price - מעל 0, מתחת ל-1000

---

### תרגיל 2.9: שאילתות מתקדמות
כתוב פונקציות:

**א.** `get_books_sorted_by_price(ascending=True)` - מיון לפי מחיר
**ב.** `get_books_paginated(page, per_page)` - דפדוף
**ג.** `search_books(keyword)` - חיפוש בכותרת או מחבר

---

### תרגיל 2.10: ספירות וקיבוצים
כתוב פונקציות:

**א.** `count_books_by_author()` - כמה ספרים לכל מחבר
**ב.** `get_total_value()` - ערך כולל של כל הספרים
**ג.** `get_books_by_decade()` - קיבוץ לפי עשורים

---

## חלק 3: קשרים בין טבלאות

### תרגיל 3.1: מודל לקוחות
צור מודל `Customer` עם השדות:
- id
- name (שם מלא)
- email (ייחודי)
- phone
- registration_date

---

### תרגיל 3.2: מודל השאלות
צור מודל `Loan` שמקשר בין לקוחות לספרים:
- id
- customer_id (מפתח זר)
- book_id (מפתח זר)
- loan_date (תאריך השאלה)
- return_date (תאריך החזרה, אופציונלי)
- is_returned (ברירת מחדל False)

**דרישות:**
- הוסף Relationships מתאימים
- קשר One-to-Many בין Customer ל-Loans
- קשר One-to-Many בין Book ל-Loans

---

### תרגיל 3.3: הוספת לקוח
כתוב פונקציה `add_customer(name, email, phone)` שמוסיפה לקוח חדש.

---

### תרגיל 3.4: רישום השאלה
כתוב פונקציה `create_loan(customer_id, book_id)` שרושמת השאלת ספר.

**דרישות:**
- בדוק שהלקוח קיים
- בדוק שהספר קיים וזמין
- עדכן את `in_stock` של הספר ל-False
- שמור את תאריך ההשאלה הנוכחי

---

### תרגיל 3.5: החזרת ספר
כתוב פונקציה `return_book(loan_id)` שמטפלת בהחזרת ספר.

**דרישות:**
- בדוק שההשאלה קיימת ולא הוחזרה
- עדכן `is_returned` ל-True
- עדכן `return_date`
- החזר את הספר למלאי (in_stock = True)

---

### תרגיל 3.6: היסטוריית לקוח
כתוב פונקציה `get_customer_history(customer_id)` שמציגה את כל ההשאלות של לקוח.

**תצוגה:**
- שם הספר
- תאריך השאלה
- תאריך החזרה (או "לא הוחזר")

---

### תרגיל 3.7: ספרים מושאלים
כתוב פונקציה `get_borrowed_books()` שמציגה את כל הספרים שמושאלים כרגע.

**תצוגה:**
- שם הספר
- שם הלקוח
- כמה ימים מושאל

---

### תרגיל 3.8: לקוחות פעילים
כתוב פונקציה `get_active_customers()` שמחזירה לקוחות שיש להם ספרים מושאלים.

---

### תרגיל 3.9: דוח השאלות
כתוב פונקציה שיוצרת דוח השאלות לחודש מסוים:
- כמה השאלות היו
- כמה הוחזרו
- כמה עדיין מושאלות
- מי הלקוח הכי פעיל

---

### תרגיל 3.10: קנסות על איחור
כתוב פונקציה `calculate_late_fees()` שמחשבת קנסות על ספרים שלא הוחזרו בזמן.

**כללים:**
- תקופת השאלה מקסימלית: 14 יום
- קנס: 5 ש"ח ליום איחור
- החזר רשימה של לקוחות עם סכום הקנס

---

## חלק 4: שילוב MySQL Connector ו-SQLModel

### תרגיל 4.1: מחלקת מנהל
צור מחלקה `LibraryManager` שמשלבת בין MySQL Connector ל-SQLModel.

**מתודות נדרשות:**
- `__init__()` - אתחול שני החיבורים
- `execute_raw_sql(query, params)` - הרצת SQL ישיר
- `add_book_orm()` - הוספה עם ORM
- `get_statistics()` - סטטיסטיקות עם SQL ישיר

---

### תרגיל 4.2: דוח ספרים פופולריים
השתמש ב-MySQL Connector לכתיבת שאילתא מורכבת שמציגה:
- 10 הספרים הכי מושאלים
- כמה פעמים כל אחד הושאל
- מי המחבר

---

### תרגיל 4.3: עדכון מחירים המוני
כתוב פונקציה שמעדכנת מחירים לפי קריטריונים:

**דוגמה:**
```python
# הוסף 10% למחיר של כל הספרים מלפני 2020
update_prices_bulk(year_before=2020, increase_percent=10)
```

**דרישות:**
- השתמש ב-MySQL Connector למהירות
- החזר כמה ספרים עודכנו

---

### תרגיל 4.4: ייבוא מ-CSV
כתוב פונקציה `import_books_from_csv(filename)` שמייבאת ספרים מקובץ CSV.

**פורמט ה-CSV:**
```
title,author,year,price
"ספר לדוגמה","מחבר לדוגמה",2020,50.00
```

**דרישות:**
- השתמש ב-executemany למהירות
- טפל בשורות שגויות
- דווח כמה ספרים יובאו

---

### תרגיל 4.5: ייצוא לדוח
כתוב פונקציה `export_monthly_report(month, year)` שיוצרת קובץ טקסט עם דוח חודשי.

**תוכן הדוח:**
- כותרת עם החודש והשנה
- סך הכנסות (ספרים שנמכרו)
- רשימת ספרים שהושאלו
- לקוחות חדשים
- סטטיסטיקות כלליות

---

### תרגיל 4.6: ניקוי בסיס נתונים
כתוב פונקציה `cleanup_database()` שמבצעת:
- מחיקת השאלות שהוחזרו לפני יותר מ-6 חודשים
- מחיקת לקוחות שלא השאילו ספרים מעולם
- איפוס מונה ה-AUTO_INCREMENT

---

### תרגיל 4.7: גיבוי ושחזור
כתוב שתי פונקציות:

**א. `backup_database(filename)`** - שומר את כל הנתונים ל-JSON
**ב. `restore_database(filename)`** - משחזר נתונים מ-JSON

---

### תרגיל 4.8: דוח תקופתי אוטומטי
צור סקריפט שרץ אוטומטית ויוצר דוח שבועי:
- השאלות השבוע
- הכנסות השבוע
- ספרים פופולריים
- שולח את הדוח למייל (סימולציה)

---

### תרגיל 4.9: מערכת המלצות
כתוב פונקציה `recommend_books(customer_id, limit=5)` שממליצה על ספרים ללקוח.

**לוגיקה:**
- מצא מחברים שהלקוח אוהב (לפי השאלות קודמות)
- מצא ספרים של אותם מחברים שהלקוח לא השאיל
- סדר לפי פופולריות

---

### תרגיל 4.10: לוח בקרה אינטראקטיבי
צור תוכנית CLI (Command Line Interface) עם תפריט:

```
=== מערכת ניהול ספרייה ===
1. הוסף ספר
2. הוסף לקוח
3. רשום השאלה
4. החזר ספר
5. חפש ספר
6. הצג סטטיסטיקות
7. ייצא דוח
8. יציאה

בחר אפשרות:
```

**דרישות:**
- תפריט מעגלי (חוזר עד שבוחרים יציאה)
- טיפול בקלט לא תקין
- הודעות ברורות למשתמש

---

## חלק 5: אתגרים מתקדמים

### אתגר 5.1: מערכת הזמנות
הרחב את המערכת להזמנת ספרים שאינם במלאי:
- טבלת `Reservations`
- כשספר חוזר למלאי, הודע ללקוח הראשון בתור
- נהל תור המתנה

---

### אתגר 5.2: דירוג וביקורות
הוסף אפשרות ללקוחות לדרג ספרים:
- טבלת `Reviews` עם דירוג (1-5) וטקסט
- חשב דירוג ממוצע לכל ספר
- הצג ביקורות

---

### אתגר 5.3: מערכת הנחות
יישם מערכת קופונים והנחות:
- טבלת `Discounts` עם קוד, אחוז הנחה, תוקף
- בדוק קופון בעת השאלה (אם יש תשלום)
- מנע שימוש כפול באותו קופון

---

### אתגר 5.4: מערכת התראות
צור מערכת התראות אוטומטית:
- התראה 3 ימים לפני תאריך החזרה
- התראה ביום ההחזרה
- התראה על איחור

---

### אתגר 5.5: אנליטיקס מתקדם
בנה דשבורד עם מדדים:
- גרף השאלות לאורך זמן
- מחברים פופולריים
- פילוח לקוחות לפי גיל/מין
- ניבוי השאלות לחודש הבא (פשוט)

---

### אתגר 5.6: ניהול רב-סניפי
התאם את המערכת למספר סניפי ספרייה:
- טבלת `Branches`
- כל ספר משוייך לסניף
- העברת ספרים בין סניפים
- דוחות לפי סניף

---

### אתגר 5.7: אופטימיזציה
שפר ביצועים:
- הוסף אינדקסים מתאימים
- אופטימז שאילתות איטיות
- השתמש ב-Connection Pooling
- מדוד זמני ביצוע לפני ואחרי

---

### אתגר 5.8: אבטחה
חזק את אבטחת המערכת:
- Hash לסיסמאות לקוחות
- הגבלת ניסיונות התחברות
- SQL Injection prevention
- הצפנת נתונים רגישים

---

### אתגר 5.9: API REST
בנה API פשוט עם Flask/FastAPI:
- GET /books - רשימת ספרים
- POST /books - הוספת ספר
- GET /books/{id} - ספר ספציפי
- POST /loans - רישום השאלה
- PUT /loans/{id}/return - החזרת ספר

---

### אתגר 5.10: פרויקט מלא
בנה מערכת ספרייה מלאה עם:
- Backend (SQLModel + MySQL)
- API (FastAPI)
- Frontend פשוט (HTML/CSS/JS)
- תיעוד מלא
- בדיקות (Tests)
- Docker Container

---

## טיפים להצלחה

✅ **תכנן לפני שאתה כותב** - שרטט את המבנה על נייר
✅ **בדוק שלב אחרי שלב** - אל תכתוב הכל בבת אחת
✅ **השתמש בנתוני דוגמה** - צור נתונים לבדיקה
✅ **טפל בשגיאות** - תמיד חשוב מה יכול להישבר
✅ **כתוב קוד נקי** - שמות משתנים ברורים, פונקציות קצרות
✅ **תעד את הקוד** - docstrings להסברים
✅ **גרסאות** - שמור את העבודה ב-Git
✅ **בקש עזרה** - תיעוד, פורומים, מדריכים

---

## משאבים מומלצים

- [SQLModel Documentation](https://sqlmodel.tiangolo.com/)
- [MySQL Connector Python](https://dev.mysql.com/doc/connector-python/en/)
- [MySQL Tutorial](https://www.mysqltutorial.org/)
- [Python MySQL](https://www.w3schools.com/python/python_mysql_getstarted.asp)

---

**בהצלחה! 🚀**

זכור: התרגול הוא המפתח להצלחה. נסה לפתור את התרגילים בעצמך לפני שאתה מסתכל על פתרונות.
