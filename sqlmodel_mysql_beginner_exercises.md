# תרגילים למתחילים - SQLModel עם MySQL

## הוראות כלליות
- כל תרגיל בנוי צעד אחר צעד
- נסה לפתור לפי הסדר
- השתמש במדריך אם נתקעת
- בדוק את הקוד עם נתוני בדיקה

---

## חלק 1: התחלה - מודלים ראשונים

### תרגיל 1.1: מודל ספר פשוט
צור מודל `Book` עם SQLModel.

**שדות נדרשים:**
- `id` - מפתח ראשי, אוטומטי
- `title` - כותרת הספר (חובה, מקסימום 200 תווים)
- `author` - שם המחבר (חובה, מקסימום 100 תווים)
- `pages` - מספר עמודים (מספר שלם)
- `price` - מחיר (מספר עשרוני)

**דרישות:**
- הגדר `__tablename__ = "books"`
- השתמש ב-`Field` עם הגבלות מתאימות

---

### תרגיל 1.2: חיבור ל-MySQL
צור חיבור לבסיס נתונים MySQL.

**דרישות:**
- צור בסיס נתונים בשם `bookstore_db`
- התחבר עם `mysql+pymysql`
- צור את הטבלה `books`
- הדפס הודעת הצלחה

**רמז:** השתמש ב-`create_engine` ו-`create_all`

---

### תרגיל 1.3: הוספת ספר ראשון
כתוב פונקציה `add_book(title, author, pages, price)` שמוסיפה ספר חדש.

**דרישות:**
- השתמש ב-`Session`
- שמור את הספר עם `commit`
- הדפס את ה-`id` של הספר שנוצר
- החזר את אובייקט הספר

---

### תרגיל 1.4: הצגת כל הספרים
כתוב פונקציה `show_all_books()` שמציגה את כל הספרים.

**דרישות:**
- השתמש ב-`select(Book)`
- הדפס כל ספר בפורמט: `ID: X | כותרת: Y | מחבר: Z | עמודים: W | מחיר: V`
- אם אין ספרים, הדפס הודעה מתאימה

---

### תרגיל 1.5: חיפוש ספר לפי ID
כתוב פונקציה `get_book_by_id(book_id)` שמחזירה ספר ספציפי.

**דרישות:**
- השתמש ב-`session.get()`
- אם הספר לא נמצא, הדפס הודעה והחזר `None`
- אם נמצא, הדפס את כל הפרטים

---

### תרגיל 1.6: עדכון מחיר ספר
כתוב פונקציה `update_book_price(book_id, new_price)` שמעדכנת מחיר.

**דרישות:**
- מצא את הספר לפי ID
- עדכן את המחיר
- שמור את השינויים
- הדפס הודעה על הצלחה או כישלון

---

### תרגיל 1.7: מחיקת ספר
כתוב פונקציה `delete_book(book_id)` שמוחקת ספר.

**דרישות:**
- מצא את הספר
- מחק אותו עם `session.delete()`
- הדפס הודעה מתאימה

---

### תרגיל 1.8: ספירת ספרים
כתוב פונקציה `count_books()` שמחזירה כמה ספרים יש במערכת.

**רמז:** השתמש ב-`len()` על רשימת הספרים

---

### תרגיל 1.9: הוספת ספרים מרשימה
כתוב פונקציה שמקבלת רשימה של ספרים ומוסיפה אותם.

**דוגמה לקלט:**
```python
books = [
    ("הארי פוטר", "ג'יי קיי רולינג", 400, 79.90),
    ("שר הטבעות", "טולקין", 600, 89.90),
    ("1984", "ג'ורג' אורוול", 350, 59.90)
]
```

**דרישות:**
- עבור על הרשימה ב-loop
- הוסף כל ספר
- הדפס כמה ספרים נוספו

---

### תרגיל 1.10: בדיקת קיום ספר
כתוב פונקציה `book_exists(title)` שבודקת אם ספר עם כותרת מסוימת קיים.

**דרישות:**
- השתמש ב-`select().where()`
- החזר `True` או `False`

---

## חלק 2: סינון וחיפוש

### תרגיל 2.1: חיפוש ספרים לפי מחבר
כתוב פונקציה `find_books_by_author(author_name)` שמחזירה את כל הספרים של מחבר.

**דרישות:**
- השתמש ב-`where(Book.author == author_name)`
- הצג את התוצאות בצורה מסודרת

---

### תרגיל 2.2: ספרים מתחת למחיר
כתוב פונקציה `get_cheap_books(max_price)` שמחזירה ספרים מתחת למחיר מסוים.

**דרישות:**
- השתמש ב-`where(Book.price < max_price)`
- מיין לפי מחיר (מהזול ליקר)

---

### תרגיל 2.3: ספרים ארוכים
כתוב פונקציה `get_long_books(min_pages)` שמחזירה ספרים עם יותר מ-X עמודים.

**דרישות:**
- סינון לפי מספר עמודים
- מיין לפי מספר עמודים (מהרבה לפחות)

---

### תרגיל 2.4: חיפוש חלקי בכותרת
כתוב פונקציה `search_books(keyword)` שמחפשת ספרים שהכותרת מכילה מילת מפתח.

**רמז:** השתמש ב-`Book.title.contains(keyword)`

---

### תרגיל 2.5: טווח מחירים
כתוב פונקציה `books_in_price_range(min_price, max_price)` שמחזירה ספרים בטווח מחירים.

**דרישות:**
- `price >= min_price AND price <= max_price`

---

### תרגיל 2.6: הספר היקר ביותר
כתוב פונקציה `get_most_expensive_book()` שמחזירה את הספר היקר ביותר.

**רמז:** השתמש ב-`order_by(Book.price.desc()).first()`

---

### תרגיל 2.7: הספר הזול ביותר
כתוב פונקציה `get_cheapest_book()` שמחזירה את הספר הזול ביותר.

---

### תרגיל 2.8: חישוב ממוצע מחיר
כתוב פונקציה `calculate_average_price()` שמחשבת את המחיר הממוצע של כל הספרים.

**רמז:** קרא את כל הספרים וחשב ממוצע בעצמך

---

### תרגיל 2.9: ספרים לפי אורך
כתוב פונקציה `get_books_sorted_by_length(ascending=True)` שמחזירה ספרים ממוינים לפי מספר עמודים.

**פרמטר:**
- `ascending=True` - מהקצר לארוך
- `ascending=False` - מהארוך לקצר

---

### תרגיל 2.10: דפדוף (Pagination)
כתוב פונקציה `get_books_page(page_number, page_size=10)` שמחזירה דף מסוים של ספרים.

**דוגמה:**
- דף 1, גודל 10: ספרים 1-10
- דף 2, גודל 10: ספרים 11-20

**רמז:** השתמש ב-`offset()` ו-`limit()`

---

## חלק 3: אימות נתונים

### תרגיל 3.1: שיפור מודל Book עם אימותים
שפר את מודל `Book` עם אימותים:

**דרישות:**
- `title` - לפחות 2 תווים
- `author` - לפחות 2 תווים
- `pages` - בין 1 ל-5000
- `price` - בין 0.01 ל-999.99

**רמז:** השתמש ב-`Field(ge=, le=, min_length=)`

---

### תרגיל 3.2: שדות אופציונליים
הוסף שדות נוספים ל-`Book`:

- `isbn` - אופציונלי, מקסימום 20 תווים, ייחודי
- `publication_year` - אופציונלי, בין 1000 ל-2030
- `in_stock` - בוליאני, ברירת מחדל `True`

---

### תרגيל 3.3: תאריך הוספה אוטומטי
הוסף שדה `created_at` שמתמלא אוטומטית בתאריך ושעה נוכחיים.

**רמז:** השתמש ב-`Field(default_factory=datetime.now)`

---

### תרגיל 3.4: בדיקת ISBN ייחודי
כתוב פונקציה `add_book_with_isbn(title, author, pages, price, isbn)` שבודקת שה-ISBN לא קיים לפני הוספה.

---

### תרגיל 3.5: עדכון מלאי
כתוב פונקציות:
- `mark_out_of_stock(book_id)` - מעדכן `in_stock=False`
- `mark_in_stock(book_id)` - מעדכן `in_stock=True`

---

### תרגיל 3.6: רשימת ספרים זמינים
כתוב פונקציה `get_available_books()` שמחזירה רק ספרים עם `in_stock=True`.

---

### תרגיל 3.7: עדכון מרובה
כתוב פונקציה `update_book(book_id, **kwargs)` שמאפשרת לעדכן כמה שדות בבת אחת.

**דוגמה לשימוש:**
```python
update_book(1, price=99.99, pages=450, in_stock=False)
```

---

### תרגיל 3.8: סטטיסטיקות ספרים
כתוב פונקציה `get_book_statistics()` שמחזירה:
- סך כל הספרים
- מחיר ממוצע
- ספרים זמינים
- ספרים לא זמינים
- מספר עמודים כולל

---

### תרגיל 3.9: ספרים שפורסמו בעשור
כתוב פונקציה `books_in_decade(decade)` שמחזירה ספרים שפורסמו בעשור מסוים.

**דוגמה:** `books_in_decade(1980)` יחזיר ספרים מ-1980-1989

---

### תרגיל 3.10: ניקוי מלאי ישן
כתוב פונקציה `remove_old_books(year)` שמוחקת ספרים שפורסמו לפני שנה מסוימת.

---

## חלק 4: קשרים בין טבלאות

### תרגיל 4.1: מודל Category (קטגוריה)
צור מודל `Category` עם השדות:
- `id`
- `name` - שם הקטגוריה (ייחודי, מקסימום 50 תווים)
- `description` - תיאור (אופציונלי)

---

### תרגיל 4.2: קשר Book ← Category
עדכן את `Book` להכיל קשר ל-`Category`:

**דרישות:**
- הוסף `category_id` (מפתח זר)
- הוסף `category` (Relationship)
- עדכן את `Category` עם רשימת `books`

---

### תרגיל 4.3: יצירת קטגוריות
כתוב פונקציה `add_category(name, description)` שמוסיפה קטגוריה.

צור לפחות 5 קטגוריות:
- מדע בדיוני
- פנטזיה
- מסתורין
- רומנטיקה
- ביוגרפיה

---

### תרגיל 4.4: הוספת ספר עם קטגוריה
כתוב פונקציה `add_book_with_category(title, author, pages, price, category_id)`.

**דרישות:**
- בדוק שהקטגוריה קיימת
- הוסף את הספר
- הדפס הודעה עם שם הקטגוריה

---

### תרגיל 4.5: ספרים לפי קטגוריה
כתוב פונקציה `get_books_by_category(category_name)` שמחזירה את כל הספרים בקטגוריה מסוימת.

---

### תרגיל 4.6: הצגת קטגוריה עם ספרים
כתוב פונקציה `show_category_with_books(category_id)` שמציגה:
- שם הקטגוריה
- תיאור
- רשימת כל הספרים בקטגוריה

---

### תרגיל 4.7: העברת ספר לקטגוריה אחרת
כתוב פונקציה `move_book_to_category(book_id, new_category_id)`.

---

### תרגיל 4.8: קטגוריות פופולריות
כתוב פונקציה `get_popular_categories()` שמציגה כל קטגוריה עם כמות הספרים בה.

**פורמט:** `קטגוריה: X | כמות ספרים: Y`

---

### תרגיל 4.9: מחיקת קטגוריה ריקה
כתוב פונקציה `delete_empty_category(category_id)` שמוחקת קטגוריה רק אם אין לה ספרים.

---

### תרגיל 4.10: מודל Author נפרד
צור מודל `Author` נפרד עם:
- `id`
- `name`
- `birth_year`
- `country`

עדכן את `Book` לקשר עם `Author` במקום שדה טקסט.

---

## חלק 5: מערכת השאלות ספרים

### תרגיל 5.1: מודל Customer (לקוח)
צור מודל `Customer` עם:
- `id`
- `name` - שם מלא
- `email` - ייחודי
- `phone` - אופציונלי
- `registration_date` - תאריך הרשמה אוטומטי

---

### תרגיל 5.2: מודל Loan (השאלה)
צור מודל `Loan` עם:
- `id`
- `customer_id` - מפתח זר ל-Customer
- `book_id` - מפתח זר ל-Book
- `loan_date` - תאריך השאלה
- `due_date` - תאריך החזרה מתוכנן (14 יום מההשאלה)
- `return_date` - תאריך החזרה בפועל (אופציונלי)
- `is_returned` - בוליאני, ברירת מחדל False

הוסף Relationships מתאימים.

---

### תרגיל 5.3: הוספת לקוח
כתוב פונקציה `register_customer(name, email, phone=None)`.

**דרישות:**
- בדוק שה-email לא קיים
- שמור את תאריך הרשמה נוכחי

---

### תרגיל 5.4: השאלת ספר
כתוב פונקציה `borrow_book(customer_id, book_id)`.

**דרישות:**
- בדוק שהלקוח קיים
- בדוק שהספר קיים וזמין (`in_stock=True`)
- צור השאלה חדשה
- עדכן את הספר ל-`in_stock=False`
- חשב `due_date` = `loan_date + 14 days`

---

### תרגיל 5.5: החזרת ספר
כתוב פונקציה `return_book(loan_id)`.

**דרישות:**
- מצא את ההשאלה
- בדוק שהספר לא הוחזר כבר
- עדכן `return_date` לתאריך נוכחי
- עדכן `is_returned=True`
- עדכן את הספר ל-`in_stock=True`

---

### תרגיל 5.6: היסטוריית השאלות של לקוח
כתוב פונקציה `get_customer_loans(customer_id)` שמציגה את כל ההשאלות של לקוח.

**תצוגה לכל השאלה:**
- שם הספר
- תאריך השאלה
- תאריך החזרה מתוכנן
- תאריך החזרה בפועל (או "לא הוחזר")

---

### תרגיל 5.7: ספרים מושאלים כרגע
כתוב פונקציה `get_borrowed_books()` שמחזירה את כל הספרים שמושאלים כרגע.

**תצוגה:**
- שם הספר
- שם הלקוח
- תאריך השאלה
- כמה ימים עברו

---

### תרגיל 5.8: ספרים באיחור
כתוב פונקציה `get_overdue_books()` שמחזירה השאלות שעברו את תאריך ההחזרה ולא הוחזרו.

**תצוגה:**
- שם הספר
- שם הלקוח
- כמה ימים באיחור

---

### תרגיל 5.9: לקוחות פעילים
כתוב פונקציה `get_active_customers()` שמחזירה לקוחות עם ספרים מושאלים כרגע.

---

### תרגיל 5.10: דוח חודשי
כתוב פונקציה `monthly_report(month, year)` שמציגה:
- כמה השאלות היו בחודש
- כמה הוחזרו
- כמה עדיין מושאלות
- הלקוח הכי פעיל (הכי הרבה השאלות)

---

## חלק 6: מערכת Reviews (ביקורות)

### תרגיל 6.1: מודל Review
צור מודל `Review` עם:
- `id`
- `book_id` - מפתח זר
- `customer_id` - מפתח זר
- `rating` - דירוג 1-5
- `comment` - טקסט הביקורת (אופציונלי)
- `review_date` - תאריך אוטומטי

---

### תרגיל 6.2: הוספת ביקורת
כתוב פונקציה `add_review(book_id, customer_id, rating, comment=None)`.

**דרישות:**
- בדוק שהדירוג בין 1-5
- בדוק שהלקוח לא כתב כבר ביקורת על הספר
- שמור את הביקורת

---

### תרגיל 6.3: ביקורות של ספר
כתוב פונקציה `get_book_reviews(book_id)` שמציגה את כל הביקורות של ספר.

---

### תרגיל 6.4: דירוג ממוצע
כתוב פונקציה `get_average_rating(book_id)` שמחשבת את הדירוג הממוצע של ספר.

---

### תרגיל 6.5: ספרים מדורגים גבוה
כתוב פונקציה `get_top_rated_books(min_rating=4.0)` שמחזירה ספרים עם דירוג ממוצע מעל X.

---

### תרגיל 6.6: הוספת דירוג למודל Book
הוסף property ל-`Book` שמחשב דירוג ממוצע:

```python
@property
def average_rating(self) -> float:
    # חשב ממוצע מכל הביקורות
    pass
```

---

### תרגיל 6.7: ביקורות של לקוח
כתוב פונקציה `get_customer_reviews(customer_id)` שמציגה את כל הביקורות של לקוח.

---

### תרגיל 6.8: עדכון ביקורת
כתוב פונקציה `update_review(review_id, rating=None, comment=None)` לעדכון ביקורת קיימת.

---

### תרגיל 6.9: מחיקת ביקורת
כתוב פונקציה `delete_review(review_id)` - רק אם הביקורת שייכת ללקוח מסוים.

---

### תרגיל 6.10: דוח ביקורות
כתוב פונקציה שמציגה:
- כמה ביקורות יש במערכת
- דירוג ממוצע כללי
- הספר עם הכי הרבה ביקורות
- הספר עם הדירוג הגבוה ביותר

---

## חלק 7: פונקציות מתקדמות

### תרגיל 7.1: ייצוא לקובץ
כתוב פונקציה `export_books_to_txt(filename)` שמייצאת את כל הספרים לקובץ טקסט.

**פורמט:**
```
=== רשימת ספרים ===
1. כותרת | מחבר | עמודים | מחיר
2. ...
```

---

### תרגיל 7.2: ייבוא מרשימה
כתוב פונקציה `import_books_from_list(books_list)` שמייבאת ספרים מרשימה.

---

### תרגיל 7.3: חיפוש מתקדם
כתוב פונקציה `advanced_search(title=None, author=None, min_price=None, max_price=None, category=None)` שמחפשת לפי כל השדות.

---

### תרגיל 7.4: גיבוי בסיס נתונים
כתוב פונקציה `backup_to_json(filename)` שמייצאת את כל הנתונים ל-JSON.

---

### תרגיל 7.5: שחזור מגיבוי
כתוב פונקציה `restore_from_json(filename)` שמשחזרת נתונים מ-JSON.

---

### תרגיל 7.6: מערכת המלצות פשוטה
כתוב פונקציה `recommend_books(customer_id, limit=5)` שממליצה על ספרים ללקוח.

**לוגיקה:**
- מצא קטגוריות שהלקוח השאיל מהן
- מצא ספרים אחרים באותן קטגוריות
- החזר ספרים שהלקוח לא השאיל

---

### תרגיל 7.7: טבלת סטטיסטיקות
כתוב פונקציה שמציגה טבלה עם סטטיסטיקות:

```
=====================================
קטגוריה        | ספרים | ממוצע מחיר
=====================================
מדע בדיוני      | 15    | 75.50
פנטזיה          | 20    | 82.30
...
```

---

### תרגיל 7.8: ניקוי אוטומטי
כתוב פונקציה `auto_cleanup()` שמבצעת:
- מחיקת השאלות שהוחזרו לפני יותר מ-6 חודשים
- מחיקת ביקורות ישנות מאוד
- מחיקת לקוחות שלא פעילים

---

### תרגיל 7.9: לוח בקרה CLI
צור תפריט אינטראקטיבי:

```
=== מערכת ניהול חנות ספרים ===
1. הוסף ספר
2. הצג כל הספרים
3. חפש ספר
4. השאל ספר
5. החזר ספר
6. הוסף ביקורת
7. סטטיסטיקות
8. יציאה

בחר אפשרות:
```

---

### תרגיל 7.10: פרויקט מלא
בנה מערכת חנות ספרים מלאה עם:
- כל המודלים (Book, Category, Author, Customer, Loan, Review)
- כל הפונקציות הבסיסיות
- תפריט אינטראקטיבי
- טיפול בשגיאות
- נתוני דוגמה להתחלה
- תיעוד בקוד

---

## טיפים להצלחה

✅ **תכנן את המבנה** - שרטט את הטבלאות והקשרים על נייר תחילה

✅ **בדוק שלב אחר שלב** - הרץ כל פונקציה מיד אחרי שאתה כותב

✅ **השתמש בנתוני דוגמה** - צור כמה ספרים ולקוחות לבדיקה

✅ **טפל בשגיאות** - תמיד בדוק אם דברים קיימים לפני פעולות

✅ **כתוב קוד נקי** - שמות משתנים ברורים, הערות, docstrings

✅ **שמור גרסאות** - commit לאחר כל תרגיל שעובד

✅ **בקש עזרה** - תיעוד, פורומים, מדריכים

---

## בדיקה עצמית

לאחר שסיימת את התרגילים, ודא ש:

- [ ] אתה יכול ליצור מודלים עם SQLModel
- [ ] אתה מבין קשרים (Relationships)
- [ ] אתה יכול לבצע CRUD (Create, Read, Update, Delete)
- [ ] אתה יודע לסנן ולחפש נתונים
- [ ] אתה יכול לעבוד עם MySQL
- [ ] אתה מטפל בשגיאות בצורה נכונה
- [ ] הקוד שלך נקי וקריא

---

## משאבים מומלצים

📚 **תיעוד:**
- [SQLModel Documentation](https://sqlmodel.tiangolo.com/)
- [SQLAlchemy Documentation](https://docs.sqlalchemy.org/)
- [Pydantic Documentation](https://docs.pydantic.dev/)

🎥 **וידאו:**
- SQLModel Tutorial by FastAPI creator
- MySQL with Python tutorials

💬 **קהילות:**
- Stack Overflow - תגית `sqlmodel`
- Reddit r/learnpython
- Discord servers for Python

---

**בהצלחה! 🚀**

זכור: העיקר זה לתרגל. אל תתייאש אם משהו לא עובד - זה חלק מהתהליך!
